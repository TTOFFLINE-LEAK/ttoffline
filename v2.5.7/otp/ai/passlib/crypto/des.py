import struct
from otp.ai.passlib import exc
from otp.ai.passlib.utils.compat import join_byte_values, byte_elem_value, irange, irange, int_types
__all__ = [
 'expand_des_key',
 'des_encrypt_block']
INT_24_MASK = 16777215
INT_56_MASK = 72057594037927935L
INT_64_MASK = 18446744073709551615L
_KDATA_MASK = 18374403900871474942L
_KPARITY_MASK = 72340172838076673L
_KS_MASK = 18229723555245850623L
PCXROT = IE3264 = SPE = CF6464 = None

def _load_tables():
    global CF6464
    global IE3264
    global PCXROT
    global SPE
    PC1ROT = (
     (0, 0, 8192, 8192, 32, 32, 8224, 8224, 1024, 1024, 9216, 9216, 1056, 1056, 9248, 9248),
     (0, 2305843009213693952L, 17179869184L, 2305843026393563136L, 140737488355328L, 2305983746702049280L,
 140754668224512L, 2305983763881918464L, 2251799813685248L, 2308094809027379200L,
 2251816993554432L, 2308094826207248384L, 2392537302040576L, 2308235546515734528L,
 2392554481909760L, 2308235563695603712L),
     (0, 0, 64, 64, 536870912, 536870912, 536870976, 536870976, 2097152, 2097152, 2097216,
 2097216, 538968064, 538968064, 538968128, 538968128),
     (0, 562949953421312L, 576460752303423488L, 577023702256844800L, 72057594037927936L,
 72620543991349248L, 648518346341351424L, 649081296294772736L, 4611686018427387904L,
 4612248968380809216L, 5188146770730811392L, 5188709720684232704L, 4683743612465315840L,
 4684306562418737152L, 5260204364768739328L, 5260767314722160640L),
     (0, 0, 262144, 262144, 2199023255552L, 2199023255552L, 2199023517696L, 2199023517696L,
 4, 4, 262148, 262148, 2199023255556L, 2199023255556L, 2199023517700L, 2199023517700L),
     (0, 70368744177664L, 144115188075855872L, 144185556820033536L, 36028797018963968L,
 36099165763141632L, 180143985094819840L, 180214353838997504L, 549755813888L, 70918499991552L,
 144115737831669760L, 144186106575847424L, 36029346774777856L, 36099715518955520L,
 180144534850633728L, 180214903594811392L),
     (0, 0, 268435456, 268435456, 4096, 4096, 268439552, 268439552, 1073741824, 1073741824,
 1342177280, 1342177280, 1073745920, 1073745920, 1342181376, 1342181376),
     (0, 68719476736L, 8796093022208L, 8864812498944L, 1152921504606846976L, 1152921573326323712L,
 1152930300699869184L, 1152930369419345920L, 1125899906842624L, 1125968626319360L,
 1134695999864832L, 1134764719341568L, 1154047404513689600L, 1154047473233166336L,
 1154056200606711808L, 1154056269326188544L),
     (0, 0, 128, 128, 524288, 524288, 524416, 524416, 8388608, 8388608, 8388736, 8388736,
 8912896, 8912896, 8913024, 8913024),
     (0, 134217728, 137438953472L, 137573171200L, 17592186044416L, 17592320262144L, 17729624997888L,
 17729759215616L, 35184372088832L, 35184506306560L, 35321811042304L, 35321945260032L,
 52776558133248L, 52776692350976L, 52913997086720L, 52914131304448L),
     (0, 0, 4194304, 4194304, 67108864, 67108864, 71303168, 71303168, 2048, 2048, 4196352,
 4196352, 67110912, 67110912, 71305216, 71305216),
     (0, 32768, 18014398509481984L, 18014398509514752L, 274877906944L, 274877939712L, 18014673387388928L,
 18014673387421696L, 9223372036854775808L, 9223372036854808576L, 9241386435364257792L,
 9241386435364290560L, 9223372311732682752L, 9223372311732715520L, 9241386710242164736L,
 9241386710242197504L),
     (0, 0, 16384, 16384, 8, 8, 16392, 16392, 16, 16, 16400, 16400, 24, 24, 16408, 16408),
     (0, 8589934592L, 281474976710656L, 281483566645248L, 288230376151711744L, 288230384741646336L,
 288511851128422400L, 288511859718356992L, 9007199254740992L, 9007207844675584L,
 9288674231451648L, 9288682821386240L, 297237575406452736L, 297237583996387328L,
 297519050383163392L, 297519058973097984L),
     (0, 0, 1099511627776L, 1099511627776L, 4294967296L, 4294967296L, 1103806595072L, 1103806595072L,
 1048576, 1048576, 1099512676352L, 1099512676352L, 4296015872L, 4296015872L, 1103807643648L,
 1103807643648L),
     (0, 2147483648L, 4398046511104L, 4400193994752L, 4503599627370496L, 4503601774854144L,
 4507997673881600L, 4507999821365248L, 34359738368L, 36507222016L, 4432406249472L,
 4434553733120L, 4503633987108864L, 4503636134592512L, 4508032033619968L, 4508034181103616L))
    PC2ROTA = (
     (0, 0, 0, 0, 2097152, 2097152, 2097152, 2097152, 67108864, 67108864, 67108864, 67108864,
 69206016, 69206016, 69206016, 69206016),
     (0, 2048, 1099511627776L, 1099511629824L, 8192, 10240, 1099511635968L, 1099511638016L,
 268435456, 268437504, 1099780063232L, 1099780065280L, 268443648, 268445696, 1099780071424L,
 1099780073472L),
     (0, 0, 0, 0, 4294967296L, 4294967296L, 4294967296L, 4294967296L, 8388608, 8388608,
 8388608, 8388608, 4303355904L, 4303355904L, 4303355904L, 4303355904L),
     (0, 2199023255552L, 2147483648L, 2201170739200L, 4194304, 2199027449856L, 2151677952L,
 2201174933504L, 134217728, 2199157473280L, 2281701376L, 2201304956928L, 138412032,
 2199161667584L, 2285895680L, 2201309151232L),
     (0, 0, 0, 0, 64, 64, 64, 64, 4096, 4096, 4096, 4096, 4160, 4160, 4160, 4160),
     (0, 16, 1024, 1040, 128, 144, 1152, 1168, 1073741824, 1073741840, 1073742848, 1073742864,
 1073741952, 1073741968, 1073742976, 1073742992),
     (0, 0, 0, 0, 524288, 524288, 524288, 524288, 1048576, 1048576, 1048576, 1048576, 1572864,
 1572864, 1572864, 1572864),
     (0, 262144, 32, 262176, 4, 262148, 36, 262180, 8589934592L, 8590196736L, 8589934624L,
 8590196768L, 8589934596L, 8590196740L, 8589934628L, 8590196772L),
     (0, 8, 32768, 32776, 4503599627370496L, 4503599627370504L, 4503599627403264L, 4503599627403272L,
 9007199254740992L, 9007199254741000L, 9007199254773760L, 9007199254773768L, 13510798882111488L,
 13510798882111496L, 13510798882144256L, 13510798882144264L),
     (0, 70368744177664L, 8796093022208L, 79164837199872L, 17592186044416L, 87960930222080L,
 26388279066624L, 96757023244288L, 4611686018427387904L, 4611756387171565568L, 4611694814520410112L,
 4611765183264587776L, 4611703610613432320L, 4611773979357609984L, 4611712406706454528L,
 4611782775450632192L),
     (0, 16384, 536870912, 536887296, 281474976710656L, 281474976727040L, 281475513581568L,
 281475513597952L, 144115188075855872L, 144115188075872256L, 144115188612726784L,
 144115188612743168L, 144396663052566528L, 144396663052582912L, 144396663589437440L,
 144396663589453824L),
     (0, 1152921504606846976L, 1125899906842624L, 1154047404513689600L, 562949953421312L,
 1153484454560268288L, 1688849860263936L, 1154610354467110912L, 34359738368L, 1152921538966585344L,
 1125934266580992L, 1154047438873427968L, 562984313159680L, 1153484488920006656L,
 1688884220002304L, 1154610388826849280L),
     (0, 18014398509481984L, 2305843009213693952L, 2323857407723175936L, 549755813888L,
 18014948265295872L, 2305843558969507840L, 2323857957478989824L, 68719476736L, 18014467228958720L,
 2305843077933170688L, 2323857476442652672L, 618475290624L, 18015016984772608L, 2305843627688984576L,
 2323858026198466560L),
     (0, 288230376151711744L, 9223372036854775808L, 9511602413006487552L, 137438953472L,
 288230513590665216L, 9223372174293729280L, 9511602550445441024L, 72057594037927936L,
 360287970189639680L, 9295429630892703744L, 9583660007044415488L, 72057731476881408L,
 360288107628593152L, 9295429768331657216L, 9583660144483368960L),
     (0, 140737488355328L, 576460752303423488L, 576601489791778816L, 274877906944L, 141012366262272L,
 576461027181330432L, 576601764669685760L, 17179869184L, 140754668224512L, 576460769483292672L,
 576601506971648000L, 292057776128L, 141029546131456L, 576461044361199616L, 576601781849554944L),
     (0, 36028797018963968L, 4398046511104L, 36033195065475072L, 2251799813685248L, 38280596832649216L,
 2256197860196352L, 38284994879160320L, 35184372088832L, 36063981391052800L, 39582418599936L,
 36068379437563904L, 2286984185774080L, 38315781204738048L, 2291382232285184L, 38320179251249152L))
    PC2ROTB = (
     (0, 0, 0, 0, 1024, 1024, 1024, 1024, 524288, 524288, 524288, 524288, 525312, 525312,
 525312, 525312),
     (0, 8388608, 16384, 8404992, 2147483648L, 2155872256L, 2147500032L, 2155888640L, 262144,
 8650752, 278528, 8667136, 2147745792L, 2156134400L, 2147762176L, 2156150784L),
     (0, 0, 0, 0, 8, 8, 8, 8, 1073741824, 1073741824, 1073741824, 1073741824, 1073741832,
 1073741832, 1073741832, 1073741832),
     (0, 536870912, 8589934592L, 9126805504L, 128, 536871040, 8589934720L, 9126805632L,
 1048576, 537919488, 8590983168L, 9127854080L, 1048704, 537919616, 8590983296L, 9127854208L),
     (0, 0, 0, 0, 8192, 8192, 8192, 8192, 2199023255552L, 2199023255552L, 2199023255552L,
 2199023255552L, 2199023263744L, 2199023263744L, 2199023263744L, 2199023263744L),
     (0, 2048, 4294967296L, 4294969344L, 268435456, 268437504, 4563402752L, 4563404800L,
 4, 2052, 4294967300L, 4294969348L, 268435460, 268437508, 4563402756L, 4563404804L),
     (0, 0, 0, 0, 4096, 4096, 4096, 4096, 16, 16, 16, 16, 4112, 4112, 4112, 4112),
     (0, 64, 1099511627776L, 1099511627840L, 2097152, 2097216, 1099513724928L, 1099513724992L,
 32768, 32832, 1099511660544L, 1099511660608L, 2129920, 2129984, 1099513757696L,
 1099513757760L),
     (0, 67108864, 134217728, 201326592, 288230376151711744L, 288230376218820608L, 288230376285929472L,
 288230376353038336L, 9223372036854775808L, 9223372036921884672L, 9223372036988993536L,
 9223372037056102400L, 9511602413006487552L, 9511602413073596416L, 9511602413140705280L,
 9511602413207814144L),
     (0, 562949953421312L, 144115188075855872L, 144678138029277184L, 1152921504606846976L,
 1153484454560268288L, 1297036692682702848L, 1297599642636124160L, 2251799813685248L,
 2814749767106560L, 146366987889541120L, 146929937842962432L, 1155173304420532224L,
 1155736254373953536L, 1299288492496388096L, 1299851442449809408L),
     (0, 4194304, 32, 4194336, 18014398509481984L, 18014398513676288L, 18014398509482016L,
 18014398513676320L, 576460752303423488L, 576460752307617792L, 576460752303423520L,
 576460752307617824L, 594475150812905472L, 594475150817099776L, 594475150812905504L,
 594475150817099808L),
     (0, 36028797018963968L, 549755813888L, 36029346774777856L, 2305843009213693952L, 2341871806232657920L,
 2305843558969507840L, 2341872355988471808L, 9007199254740992L, 45035996273704960L,
 9007749010554880L, 45036546029518848L, 2314850208468434944L, 2350879005487398912L,
 2314850758224248832L, 2350879555243212800L),
     (0, 137438953472L, 4398046511104L, 4535485464576L, 4611686018427387904L, 4611686155866341376L,
 4611690416473899008L, 4611690553912852480L, 70368744177664L, 70506183131136L, 74766790688768L,
 74904229642240L, 4611756387171565568L, 4611756524610519040L, 4611760785218076672L,
 4611760922657030144L),
     (0, 274877906944L, 35184372088832L, 35459249995776L, 8796093022208L, 9070970929152L,
 43980465111040L, 44255343017984L, 140737488355328L, 141012366262272L, 175921860444160L,
 176196738351104L, 149533581377536L, 149808459284480L, 184717953466368L, 184992831373312L),
     (0, 34359738368L, 17179869184L, 51539607552L, 17592186044416L, 17626545782784L, 17609365913600L,
 17643725651968L, 4503599627370496L, 4503633987108864L, 4503616807239680L, 4503651166978048L,
 4521191813414912L, 4521226173153280L, 4521208993284096L, 4521243353022464L),
     (0, 72057594037927936L, 281474976710656L, 72339069014638592L, 68719476736L, 72057662757404672L,
 281543696187392L, 72339137734115328L, 1125899906842624L, 73183493944770560L, 1407374883553280L,
 73464968921481216L, 1125968626319360L, 73183562664247296L, 1407443603030016L, 73465037640957952L))
    PCXROT = (
     (
      PC1ROT, PC2ROTA), (PC2ROTB, PC2ROTB),
     (
      PC2ROTB, PC2ROTB), (PC2ROTB, PC2ROTB),
     (
      PC2ROTA, PC2ROTB), (PC2ROTB, PC2ROTB),
     (
      PC2ROTB, PC2ROTB), (PC2ROTB, PC2ROTA))
    IE3264 = (
     (0, 8390656, 32776, 8423432, 549890031616L, 549898422272L, 549890064392L, 549898455048L,
 2148007936L, 2156398592L, 2148040712L, 2156431368L, 552038039552L, 552046430208L,
 552038072328L, 552046462984L),
     (0, 36037593111986176L, 140771848093696L, 36178364960079872L, 576460752303423616L,
 612498345415409792L, 576601524151517312L, 612639117263503488L, 9225623836668461056L,
 9261661429780447232L, 9225764608516554752L, 9261802201628540928L, 9802084588971884672L,
 9838122182083870848L, 9802225360819978368L, 9838262953931964544L),
     (0, 4096, 16, 4112, 268435456, 268439552, 268435472, 268439568, 1048576, 1052672, 1048592,
 1052688, 269484032, 269488128, 269484048, 269488144),
     (0, 17592186044416L, 68719476736L, 17660905521152L, 1152921504606846976L, 1152939096792891392L,
 1152921573326323712L, 1152939165512368128L, 4503599627370496L, 4521191813414912L,
 4503668346847232L, 4521260532891648L, 1157425104234217472L, 1157442696420261888L,
 1157425172953694208L, 1157442765139738624L),
     (0, 8192, 32, 8224, 536870912, 536879104, 536870944, 536879136, 2097152, 2105344, 2097184,
 2105376, 538968064, 538976256, 538968096, 538976288),
     (0, 35184372088832L, 137438953472L, 35321811042304L, 2305843009213693952L, 2305878193585782784L,
 2305843146652647424L, 2305878331024736256L, 9007199254740992L, 9042383626829824L,
 9007336693694464L, 9042521065783296L, 2314850208468434944L, 2314885392840523776L,
 2314850345907388416L, 2314885530279477248L),
     (0, 16388, 288230376151711808L, 288230376151728196L, 1074003968, 1074020356, 288230377225715776L,
 288230377225732164L, 4195328, 4211716, 288230376155907136L, 288230376155923524L,
 1078199296, 1078215684, 288230377229911104L, 288230377229927492L),
     (0, 70385924046848L, 274945015808L, 70660869062656L, 4612811918334230528L, 4612882304258277376L,
 4612812193279246336L, 4612882579203293184L, 18018796555993088L, 18089182480039936L,
 18019071501008896L, 18089457425055744L, 4630830714890223616L, 4630901100814270464L,
 4630830989835239424L, 4630901375759286272L))
    SPE = (
     (36038143004114944L, 549890031616L, 2097184, 36038143004114976L, 2097152, 36038143002017824L,
 549890031648L, 2097184, 36038143002017824L, 36038143004114944L, 549892128768L, 36037593111986208L,
 36037593114083360L, 2097152, 0, 549890031648L, 549890031616L, 32, 36037593114083328L,
 36038143002017792L, 36038143004114976L, 549892128768L, 36037593111986208L, 36037593114083328L,
 32, 36037593111986176L, 36038143002017792L, 549892128800L, 36037593111986176L, 36037593114083360L,
 549892128800L, 0, 0, 36038143004114976L, 36037593114083328L, 549890031648L, 36038143004114944L,
 549890031616L, 36037593111986208L, 36037593114083328L, 549892128800L, 36037593111986176L,
 36038143002017792L, 2097184, 36038143002017824L, 32, 2097184, 549892128768L, 36038143004114976L,
 36038143002017792L, 549892128768L, 36037593114083360L, 2097152, 36037593111986208L,
 549890031648L, 0, 549890031616L, 2097152, 36037593114083360L, 36038143004114944L,
 32, 549892128800L, 36037593111986176L, 36038143002017824L),
     (1153062276723392516L, 0, 140772116529152L, 268451844, 1152921504606863364L, 1153062276454940672L,
 140771848110084L, 140772116529152L, 140771848093696L, 1152921504875298820L, 1152921504606846976L,
 140771848110084L, 1152921504875282432L, 140772116545540L, 268451844, 1152921504606846976L,
 268435456, 1153062276454957060L, 1152921504875298820L, 140771848093696L, 1153062276723376128L,
 16388, 0, 1152921504875282432L, 1153062276454957060L, 1153062276723376128L, 140772116545540L,
 1152921504606863364L, 16388, 268435456, 1153062276454940672L, 1153062276723392516L,
 1152921504875282432L, 140772116545540L, 140771848110084L, 1153062276723376128L,
 1153062276723392516L, 1152921504875282432L, 1152921504606863364L, 0, 16388, 1153062276454940672L,
 268435456, 1152921504875298820L, 140771848093696L, 16388, 1153062276723376128L,
 1153062276454957060L, 140772116545540L, 140771848093696L, 0, 1152921504606863364L,
 1152921504606846976L, 1153062276723392516L, 140772116529152L, 268451844, 1152921504875298820L,
 268435456, 1153062276454940672L, 140771848110084L, 1153062276454957060L, 1152921504606846976L,
 268451844, 140772116529152L),
     (4195344, 4503874576581632L, 4503599627370496L, 4503599631565840L, 274945015824L, 4195328,
 4503599631565840L, 4503874572386304L, 4503599631565824L, 274945015808L, 274949211136L,
 16, 4503874576581648L, 4503599627370512L, 16, 274949211152L, 0, 274945015824L, 4503874576581632L,
 4503599627370496L, 4503599627370512L, 4503874576581648L, 274945015808L, 4195344,
 274949211152L, 4503599631565824L, 4503874572386320L, 274949211136L, 4503874572386304L,
 0, 4195328, 4503874572386320L, 4503874576581632L, 4503599627370496L, 16, 274945015808L,
 4503599627370512L, 274945015824L, 274949211136L, 4503599631565840L, 0, 4503874576581632L,
 4503874572386304L, 274949211152L, 274945015824L, 4195328, 4503874576581648L, 16,
 4503874572386320L, 4195344, 4195328, 4503874576581648L, 274945015808L, 4503599631565824L,
 4503599631565840L, 4503874572386304L, 4503599631565824L, 0, 274949211152L, 4503599627370512L,
 4195344, 4503874572386320L, 4503599627370496L, 274949211136L),
     (576478345563472000L, 17592186048512L, 576460752303423616L, 576478345563476096L, 0,
 1074008064, 576478344489472128L, 576460753377427584L, 17593260052480L, 576460752303427712L,
 4096, 576478344489468032L, 576460752303427712L, 576478345563472000L, 1074003968,
 4096, 576460753377431680L, 17593260048384L, 17592186044416L, 576460752303423616L,
 17593260048384L, 576478344489472128L, 1074008064, 17592186044416L, 576478344489468032L,
 0, 576460753377427584L, 17593260052480L, 17592186048512L, 576460753377431680L, 576478345563476096L,
 1074003968, 576460753377431680L, 576478344489468032L, 1074003968, 576460752303427712L,
 17593260048384L, 17592186048512L, 576460752303423616L, 1074008064, 576478344489472128L,
 0, 17592186044416L, 576460753377427584L, 0, 576460753377431680L, 17593260052480L,
 17592186044416L, 4096, 576478345563476096L, 576478345563472000L, 1074003968, 576478345563476096L,
 576460752303423616L, 17592186048512L, 576478345563472000L, 576460753377427584L,
 17593260048384L, 1074008064, 576478344489472128L, 576478344489468032L, 4096, 576460752303427712L,
 17593260052480L),
     (8390656, 68719476736L, 18018796555993088L, 2323861874497554432L, 2305843077941561344L,
 18018796564383744L, 2323861874489163776L, 68727867392L, 68719476736L, 2305843009213693952L,
 2305843009222084608L, 18018865275469824L, 2323861805778077696L, 2305843077941561344L,
 18018865283860480L, 0, 18018865275469824L, 8390656, 2305843077933170688L, 2323861805769687040L,
 18018796564383744L, 2323861874489163776L, 0, 2305843009222084608L, 2305843009213693952L,
 2323861805778077696L, 2323861874497554432L, 2305843077933170688L, 68727867392L,
 18018796555993088L, 2323861805769687040L, 18018865283860480L, 18018865283860480L,
 2323861805778077696L, 2305843077933170688L, 68727867392L, 68719476736L, 2305843009213693952L,
 2305843009222084608L, 18018796564383744L, 8390656, 18018865275469824L, 2323861874497554432L,
 0, 2323861874489163776L, 8390656, 18018796555993088L, 2305843077933170688L, 2323861805778077696L,
 18018796555993088L, 0, 2323861874497554432L, 2305843077941561344L, 18018865283860480L,
 2323861805769687040L, 68719476736L, 18018865275469824L, 2305843077941561344L, 18018796564383744L,
 2323861805769687040L, 2305843009213693952L, 2323861874489163776L, 68727867392L,
 2305843009222084608L),
     (4612811918334263304L, 4612811918871101440L, 0, 35184908992520L, 4612811918871101440L,
 35184372088832L, 4612847102706352136L, 536870912, 4612847102706319360L, 4612847103243223048L,
 35184908959744L, 32776, 35184372121608L, 4612811918334263304L, 536903688, 4612847103243190272L,
 536870912, 4612847102706352136L, 4612811918871134216L, 0, 35184372088832L, 4612811918334230528L,
 35184908992520L, 4612811918871134216L, 4612847103243223048L, 536903688, 32776, 4612847102706319360L,
 4612811918334230528L, 35184908959744L, 4612847103243190272L, 35184372121608L, 4612847102706319360L,
 32776, 35184372121608L, 4612847103243190272L, 35184908992520L, 4612811918871101440L,
 0, 35184372121608L, 32776, 35184372088832L, 4612811918871134216L, 536870912, 4612811918871101440L,
 4612847103243223048L, 35184908959744L, 4612811918334230528L, 4612847103243223048L,
 35184908959744L, 536870912, 4612847102706352136L, 4612811918334263304L, 536903688,
 4612847103243190272L, 0, 35184372088832L, 4612811918334263304L, 4612847102706352136L,
 35184908992520L, 536903688, 4612847102706319360L, 4612811918334230528L, 4612811918871134216L),
     (70385924046848L, 9007199254740992L, 9007199255789568L, 288230376152760384L, 297307961331548224L,
 288300762075758656L, 9077585178787840L, 0, 1048576, 297237575407501376L, 297237575406452800L,
 70385925095424L, 288230376151711808L, 9077585179836416L, 70385925095424L, 297237575406452800L,
 297237575407501376L, 70385924046848L, 288300762075758656L, 297307961331548224L,
 0, 9007199255789568L, 288230376152760384L, 9077585178787840L, 288300762076807232L,
 297307961330499648L, 9077585179836416L, 288230376151711808L, 297307961330499648L,
 288300762076807232L, 9007199254740992L, 1048576, 297307961330499648L, 70385925095424L,
 288300762076807232L, 297237575406452800L, 70385924046848L, 9007199254740992L, 1048576,
 288300762076807232L, 297237575407501376L, 297307961330499648L, 9077585178787840L,
 0, 9007199254740992L, 288230376152760384L, 288230376151711808L, 9007199255789568L,
 0, 297237575407501376L, 9007199255789568L, 9077585178787840L, 297237575406452800L,
 70385924046848L, 297307961331548224L, 1048576, 9077585179836416L, 288230376151711808L,
 288300762075758656L, 297307961331548224L, 288230376152760384L, 9077585179836416L,
 70385925095424L, 288300762075758656L),
     (9225623838816477184L, 139586969600L, 9225623974107414528L, 0, 137438961664L, 9225623838816468992L,
 2148016128L, 9225623976255430656L, 9225623836668461056L, 8192, 139586961408L, 9225623974107414528L,
 9225623976255422464L, 9225623974107422720L, 9225623836668469248L, 2148016128L, 137438953472L,
 9225623976255422464L, 9225623838816468992L, 137438961664L, 9225623976255430656L,
 9225623836668469248L, 0, 139586961408L, 8192, 2148007936L, 9225623974107422720L,
 9225623838816477184L, 2148007936L, 137438953472L, 139586969600L, 9225623836668461056L,
 2148007936L, 137438953472L, 9225623836668469248L, 9225623976255430656L, 9225623974107414528L,
 8192, 0, 139586961408L, 9225623838816477184L, 9225623974107422720L, 137438961664L,
 9225623838816468992L, 139586969600L, 9225623836668461056L, 9225623838816468992L,
 137438961664L, 9225623976255430656L, 2148007936L, 2148016128L, 9225623836668469248L,
 139586961408L, 9225623974107414528L, 9225623974107422720L, 2148016128L, 9225623836668461056L,
 139586969600L, 9225623976255422464L, 0, 8192, 9225623838816477184L, 137438953472L,
 9225623976255422464L))
    CF6464 = (
     (0, 137438953472L, 35184372088832L, 35321811042304L, 9007199254740992L, 9007336693694464L,
 9042383626829824L, 9042521065783296L, 2305843009213693952L, 2305843146652647424L,
 2305878193585782784L, 2305878331024736256L, 2314850208468434944L, 2314850345907388416L,
 2314885392840523776L, 2314885530279477248L),
     (0, 8589934592L, 2199023255552L, 2207613190144L, 562949953421312L, 562958543355904L,
 565148976676864L, 565157566611456L, 144115188075855872L, 144115196665790464L, 144117387099111424L,
 144117395689046016L, 144678138029277184L, 144678146619211776L, 144680337052532736L,
 144680345642467328L),
     (0, 32, 8192, 8224, 2097152, 2097184, 2105344, 2105376, 536870912, 536870944, 536879104,
 536879136, 538968064, 538968096, 538976256, 538976288),
     (0, 2, 512, 514, 131072, 131074, 131584, 131586, 33554432, 33554434, 33554944, 33554946,
 33685504, 33685506, 33686016, 33686018),
     (0, 549755813888L, 140737488355328L, 141287244169216L, 36028797018963968L, 36029346774777856L,
 36169534507319296L, 36170084263133184L, 9223372036854775808L, 9223372586610589696L,
 9223512774343131136L, 9223513324098945024L, 9259400833873739776L, 9259401383629553664L,
 9259541571362095104L, 9259542121117908992L),
     (0, 34359738368L, 8796093022208L, 8830452760576L, 2251799813685248L, 2251834173423616L,
 2260595906707456L, 2260630266445824L, 576460752303423488L, 576460786663161856L,
 576469548396445696L, 576469582756184064L, 578712552117108736L, 578712586476847104L,
 578721348210130944L, 578721382569869312L),
     (0, 128, 32768, 32896, 8388608, 8388736, 8421376, 8421504, 2147483648L, 2147483776L,
 2147516416L, 2147516544L, 2155872256L, 2155872384L, 2155905024L, 2155905152L),
     (0, 8, 2048, 2056, 524288, 524296, 526336, 526344, 134217728, 134217736, 134219776,
 134219784, 134742016, 134742024, 134744064, 134744072),
     (0, 68719476736L, 17592186044416L, 17660905521152L, 4503599627370496L, 4503668346847232L,
 4521191813414912L, 4521260532891648L, 1152921504606846976L, 1152921573326323712L,
 1152939096792891392L, 1152939165512368128L, 1157425104234217472L, 1157425172953694208L,
 1157442696420261888L, 1157442765139738624L),
     (0, 4294967296L, 1099511627776L, 1103806595072L, 281474976710656L, 281479271677952L,
 282574488338432L, 282578783305728L, 72057594037927936L, 72057598332895232L, 72058693549555712L,
 72058697844523008L, 72339069014638592L, 72339073309605888L, 72340168526266368L,
 72340172821233664L),
     (0, 16, 4096, 4112, 1048576, 1048592, 1052672, 1052688, 268435456, 268435472, 268439552,
 268439568, 269484032, 269484048, 269488128, 269488144),
     (0, 1, 256, 257, 65536, 65537, 65792, 65793, 16777216, 16777217, 16777472, 16777473,
 16842752, 16842753, 16843008, 16843009),
     (0, 274877906944L, 70368744177664L, 70643622084608L, 18014398509481984L, 18014673387388928L,
 18084767253659648L, 18085042131566592L, 4611686018427387904L, 4611686293305294848L,
 4611756387171565568L, 4611756662049472512L, 4629700416936869888L, 4629700691814776832L,
 4629770785681047552L, 4629771060558954496L),
     (0, 17179869184L, 4398046511104L, 4415226380288L, 1125899906842624L, 1125917086711808L,
 1130297953353728L, 1130315133222912L, 288230376151711744L, 288230393331580928L,
 288234774198222848L, 288234791378092032L, 289356276058554368L, 289356293238423552L,
 289360674105065472L, 289360691284934656L),
     (0, 64, 16384, 16448, 4194304, 4194368, 4210688, 4210752, 1073741824, 1073741888, 1073758208,
 1073758272, 1077936128, 1077936192, 1077952512, 1077952576),
     (0, 4, 1024, 1028, 262144, 262148, 263168, 263172, 67108864, 67108868, 67109888, 67109892,
 67371008, 67371012, 67372032, 67372036))


def _permute(c, p):
    out = 0
    for r in p:
        out |= r[(c & 15)]
        c >>= 4

    return out


_uint64_struct = struct.Struct('>Q')

def _pack64(value):
    return _uint64_struct.pack(value)


def _unpack64(value):
    return _uint64_struct.unpack(value)[0]


def _pack56(value):
    return _uint64_struct.pack(value)[1:]


def _unpack56(value):
    return _uint64_struct.unpack('\x00' + value)[0]


_EXPAND_ITER = irange(49, -7, -7)

def expand_des_key(key):
    if isinstance(key, bytes):
        if len(key) != 7:
            raise ValueError('key must be 7 bytes in size')
    else:
        if isinstance(key, int_types):
            if key < 0 or key > INT_56_MASK:
                raise ValueError('key must be 56-bit non-negative integer')
            return _unpack64(expand_des_key(_pack56(key)))
        raise exc.ExpectedTypeError(key, 'bytes or int', 'key')
    key = _unpack56(key)
    return join_byte_values((key >> shift & 127) << 1 for shift in _EXPAND_ITER)


def shrink_des_key(key):
    if isinstance(key, bytes):
        if len(key) != 8:
            raise ValueError('key must be 8 bytes in size')
        return _pack56(shrink_des_key(_unpack64(key)))
    if isinstance(key, int_types):
        if key < 0 or key > INT_64_MASK:
            raise ValueError('key must be 64-bit non-negative integer')
    else:
        raise exc.ExpectedTypeError(key, 'bytes or int', 'key')
    key >>= 1
    result = 0
    offset = 0
    while offset < 56:
        result |= (key & 127) << offset
        key >>= 8
        offset += 7

    return result


def des_encrypt_block(key, input, salt=0, rounds=1):
    if isinstance(key, bytes):
        if len(key) == 7:
            key = expand_des_key(key)
        else:
            if len(key) != 8:
                raise ValueError('key must be 7 or 8 bytes')
        key = _unpack64(key)
    else:
        raise exc.ExpectedTypeError(key, 'bytes', 'key')
    if isinstance(input, bytes):
        if len(input) != 8:
            raise ValueError('input block must be 8 bytes')
        input = _unpack64(input)
    else:
        raise exc.ExpectedTypeError(input, 'bytes', 'input')
    result = des_encrypt_int_block(key, input, salt, rounds)
    return _pack64(result)


def des_encrypt_int_block(key, input, salt=0, rounds=1):
    if rounds < 1:
        raise ValueError('rounds must be positive integer')
    if salt < 0 or salt > INT_24_MASK:
        raise ValueError('salt must be 24-bit non-negative integer')
    if not isinstance(key, int_types):
        raise exc.ExpectedTypeError(key, 'int', 'key')
    else:
        if key < 0 or key > INT_64_MASK:
            raise ValueError('key must be 64-bit non-negative integer')
    if not isinstance(input, int_types):
        raise exc.ExpectedTypeError(input, 'int', 'input')
    else:
        if input < 0 or input > INT_64_MASK:
            raise ValueError('input must be 64-bit non-negative integer')
        if PCXROT is None:
            _load_tables()
        SPE0, SPE1, SPE2, SPE3, SPE4, SPE5, SPE6, SPE7 = SPE

        def _iter_key_schedule(ks_odd):
            for p_even, p_odd in PCXROT:
                ks_even = _permute(ks_odd, p_even)
                ks_odd = _permute(ks_even, p_odd)
                yield (ks_even & _KS_MASK, ks_odd & _KS_MASK)

        ks_list = list(_iter_key_schedule(key))
        salt = (salt & 63) << 26 | (salt & 4032) << 12 | (salt & 258048) >> 2 | (salt & 16515072) >> 16
        if input == 0:
            L = R = 0
        else:
            L = input >> 31 & 2863311530L | input & 1431655765
            L = _permute(L, IE3264)
            R = input >> 32 & 2863311530L | input >> 1 & 1431655765
            R = _permute(R, IE3264)
        while rounds:
            rounds -= 1
            for ks_even, ks_odd in ks_list:
                k = (R >> 32 ^ R) & salt
                B = k << 32 ^ k ^ R ^ ks_even
                L ^= SPE0[(B >> 58 & 63)] ^ SPE1[(B >> 50 & 63)] ^ SPE2[(B >> 42 & 63)] ^ SPE3[(B >> 34 & 63)] ^ SPE4[(B >> 26 & 63)] ^ SPE5[(B >> 18 & 63)] ^ SPE6[(B >> 10 & 63)] ^ SPE7[(B >> 2 & 63)]
                k = (L >> 32 ^ L) & salt
                B = k << 32 ^ k ^ L ^ ks_odd
                R ^= SPE0[(B >> 58 & 63)] ^ SPE1[(B >> 50 & 63)] ^ SPE2[(B >> 42 & 63)] ^ SPE3[(B >> 34 & 63)] ^ SPE4[(B >> 26 & 63)] ^ SPE5[(B >> 18 & 63)] ^ SPE6[(B >> 10 & 63)] ^ SPE7[(B >> 2 & 63)]

            L, R = R, L

    C = L >> 3 & 1085102592318504960L | L << 33 & 17361641477096079360L | R >> 35 & 252645135 | R << 1 & 4042322160L
    return _permute(C, CF6464)